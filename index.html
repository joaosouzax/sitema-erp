import hashlib
import sqlite3

class UserManager:
    def __init__(self, db_path='fireworks.db'):
        self.db_path = db_path
        self.conn = sqlite3.connect(self.db_path)
        self.cursor = self.conn.cursor()
        self.create_table()

    def create_table(self):
        self.cursor.execute("""
            CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY,
                username TEXT UNIQUE NOT NULL,
                password TEXT NOT NULL,
                role TEXT DEFAULT 'user'
            )
        """)
        self.conn.commit()

    def create_user(self, username, password, role='user'):
        hashed_password = hashlib.sha256(password.encode()).hexdigest()
        try:
            self.cursor.execute("INSERT INTO users (username, password, role) VALUES (?, ?, ?)",
                                (username, hashed_password, role))
            self.conn.commit()
            return True
        except sqlite3.IntegrityError:
            return False

    def authenticate_user(self, username, password):
        self.cursor.execute("SELECT * FROM users WHERE username = ?", (username,))
        user = self.cursor.fetchone()
        if user:
            hashed_password = hashlib.sha256(password.encode()).hexdigest()
            if hashed_password == user[2]:
                return {'id': user[0], 'username': user[1], 'role': user[3]}
        return None

    def get_user(self, user_id):
         self.cursor.execute("SELECT id, username, role FROM users WHERE id = ?", (user_id,))
         user = self.cursor.fetchone()
         if user:
             return {'id': user[0], 'username': user[1], 'role': user[2]}
         return None

    def close(self):
        self.conn.close()

# Example usage:
if __name__ == '__main__':
    user_manager = UserManager()
    if user_manager.create_user('admin', 'admin123', 'admin'):
        print('Admin user created successfully.')
    else:
        print('Admin user already exists.')

    user = user_manager.authenticate_user('admin', 'admin123')
    if user:
        print(f'User authenticated: {user}')
    else:
        print('Authentication failed.')

    user_manager.close()import pandas as pd

class ExcelExporter:
    def __init__(self):
        pass

    def export_data(self, data, filename='data.xlsx'):
        """
        Exporta uma lista de dicionários para um arquivo Excel.

        :param data: Lista de dicionários, onde cada dicionário representa uma linha.
        :param filename: Nome do arquivo Excel a ser criado.
        """
        df = pd.DataFrame(data)
        df.to_excel(filename, index=False)
        print(f"Data exported to {filename}")

# Example usage:
if __name__ == '__main__':
    exporter = ExcelExporter()
    data = [
        {'ID': 1, 'Nome': 'Produto A', 'Quantidade': 10, 'Preço': 25.50},
        {'ID': 2, 'Nome': 'Produto B', 'Quantidade': 5, 'Preço': 50.00},
        {'ID': 3, 'Nome': 'Produto C', 'Quantidade': 15, 'Preço': 10.20}
    ]
    exporter.export_data(data, 'estoque.xlsx')
    import sqlite3

class Database:
    def __init__(self, db_path='fireworks.db'):
        self.db_path = db_path
        self.conn = sqlite3.connect(self.db_path)
        self.cursor = self.conn.cursor()

    def create_table(self, sql):
        self.cursor.execute(sql)
        self.conn.commit()

    def insert(self, sql, params):
        self.cursor.execute(sql, params)
        self.conn.commit()

    def update(self, sql, params):
        self.cursor.execute(sql, params)
        self.conn.commit()

    def delete(self, sql, params):
        self.cursor.execute(sql, params)
        self.conn.commit()

    def fetch_one(self, sql, params=None):
        if params:
            self.cursor.execute(sql, params)
        else:
            self.cursor.execute(sql)
        return self.cursor.fetchone()

    def fetch_all(self, sql, params=None):
        if params:
            self.cursor.execute(sql, params)
        else:
            self.cursor.execute(sql)
        return self.cursor.fetchall()

    def close(self):
        self.conn.close()
        import qrcode
import barcode
from barcode.writer import ImageWriter

class BarcodeGenerator:
    def __init__(self):
        pass

    def generate_qrcode(self, data, filename="qrcode.png"):
        """
        Gera um QR code a partir dos dados fornecidos e salva como imagem.

        :param data: Dados a serem codificados no QR code.
        :param filename: Nome do arquivo de imagem a ser criado.
        """
        qr = qrcode.QRCode(
            version=1,
            error_correction=qrcode.constants.ERROR_CORRECT_L,
            box_size=10,
            border=4,
        )
        qr.add_data(data)
        qr.make(fit=True)

        img = qr.make_image(fill_color="black", back_color="white")
        img.save(filename)
        print(f"QR code gerado e salvo como {filename}")

    def generate_barcode(self, data, barcode_type='ean13', filename="barcode.png"):
        """
        Gera um código de barras a partir dos dados fornecidos e salva como imagem.

        :param data: Dados a serem codificados no código de barras.
        :param barcode_type: Tipo de código de barras (ean13, code128, etc.).
        :param filename: Nome do arquivo de imagem a ser criado.
        """
        barcode_class = barcode.get(barcode_type, data, writer=ImageWriter())
        filename_without_ext = filename.split('.')[0]
        barcode_class.save(filename_without_ext)
        print(f"Código de barras gerado e salvo como {filename}")

# Example usage:
if __name__ == '__main__':
    generator = BarcodeGenerator()
    generator.generate_qrcode("https://www.example.com", "example_qrcode.png")
    generator.generate_barcode("123456789012", 'ean13', "example_barcode.png")
    import sqlite3
from core.database import Database

class FogosArtificioItem:
    def __init__(self, id, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor):
        self.id = id
        self.nome = nome
        self.descricao = descricao
        self.quantidade = quantidade
        self.preco_compra = preco_compra
        self.preco_venda = preco_venda
        self.categoria = categoria
        self.fornecedor = fornecedor

class EstoqueModel:
    def __init__(self, db_path='fireworks.db'):
        self.db = Database(db_path)
        self.db.create_table("""
            CREATE TABLE IF NOT EXISTS estoque (
                id INTEGER PRIMARY KEY,
                nome TEXT NOT NULL,
                descricao TEXT,
                quantidade INTEGER NOT NULL,
                preco_compra REAL NOT NULL,
                preco_venda REAL NOT NULL,
                categoria TEXT,
                fornecedor TEXT
            )
        """)

    def adicionar_item(self, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor):
        self.db.insert("INSERT INTO estoque (nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor) VALUES (?, ?, ?, ?, ?, ?, ?)",
                       (nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor))

    def atualizar_item(self, id, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor):
        self.db.update("UPDATE estoque SET nome = ?, descricao = ?, quantidade = ?, preco_compra = ?, preco_venda = ?, categoria = ?, fornecedor = ? WHERE id = ?",
                       (nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor, id))

    def remover_item(self, id):
        self.db.delete("DELETE FROM estoque WHERE id = ?", (id,))

    def listar_itens(self):
        items = self.db.fetch_all("SELECT id, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor FROM estoque")
        return [FogosArtificioItem(id, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor) for id, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor in items]

    def get_item(self, id):
        item = self.db.fetch_one("SELECT id, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor FROM estoque WHERE id = ?", (id,))
        if item:
            return FogosArtificioItem(item[0], item[1], item[2], item[3], item[4], item[5], item[6], item[7])
        return None
        class EstoqueView:
    def exibir_item(self, item):
        print(f"ID: {item.id}, Nome: {item.nome}, Descrição: {item.descricao}, Quantidade: {item.quantidade}, "
              f"Preço de Compra: {item.preco_compra}, Preço de Venda: {item.preco_venda}, Categoria: {item.categoria}, Fornecedor: {item.fornecedor}")

    def exibir_lista(self, itens):
        for item in itens:
            self.exibir_item(item)
            from modules.estoque.models import EstoqueModel
from modules.estoque.views import EstoqueView

class EstoqueController:
    def __init__(self):
        self.model = EstoqueModel()
        self.view = EstoqueView()

    def adicionar_item(self, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor):
        self.model.adicionar_item(nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor)

    def atualizar_item(self, id, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor):
        self.model.atualizar_item(id, nome, descricao, quantidade, preco_compra, preco_venda, categoria, fornecedor)

    def remover_item(self, id):
        self.model.remover_item(id)

    def listar_itens(self):
        itens = self.model.listar_itens()
        self.view.exibir_lista(itens)

    def get_item(self, id):
        item = self.model.get_item(id)
        if item:
            self.view.exibir_item(item)
        else:
            print("Item não encontrado.")
            import sqlite3
from core.database import Database
from datetime import datetime

class VendaItem:
    def __init__(self, id, data, item_id, quantidade, preco_unitario):
        self.id = id
        self.data = data
        self.item_id = item_id
        self.quantidade = quantidade
        self.preco_unitario = preco_unitario

class VendasModel:
    def __init__(self, db_path='fireworks.db'):
        self.db = Database(db_path)
        self.db.create_table("""
            CREATE TABLE IF NOT EXISTS vendas (
                id INTEGER PRIMARY KEY,
                data TEXT NOT NULL,
                item_id INTEGER NOT NULL,
                quantidade INTEGER NOT NULL,
                preco_unitario REAL NOT NULL,
                FOREIGN KEY (item_id) REFERENCES estoque (id)
            )
        """)

    def registrar_venda(self, item_id, quantidade, preco_unitario):
        data_atual = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        self.db.insert("INSERT INTO vendas (data, item_id, quantidade, preco_unitario) VALUES (?, ?, ?, ?)",
                       (data_atual, item_id, quantidade, preco_unitario))

    def listar_vendas(self):
        vendas = self.db.fetch_all("SELECT id, data, item_id, quantidade, preco_unitario FROM vendas")
        return [VendaItem(id, data, item_id, quantidade, preco_unitario) for id, data, item_id, quantidade, preco_unitario in vendas]

    def get_venda(self, id):
        venda = self.db.fetch_one("SELECT id, data, item_id, quantidade, preco_unitario FROM vendas WHERE id = ?", (id,))
        if venda:
            return VendaItem(venda[0], venda[1], venda[2], venda[3], venda[4])
        return None
        class VendasView:
    def exibir_venda(self, venda):
        print(f"ID: {venda.id}, Data: {venda.data}, Item ID: {venda.item_id}, Quantidade: {venda.quantidade}, Preço Unitário: {venda.preco_unitario}")

    def exibir_lista(self, vendas):
        for venda in vendas:
            self.exibir_venda(venda)
            from modules.vendas.models import VendasModel
from modules.vendas.views import VendasView

class VendasController:
    def __init__(self):
        self.model = VendasModel()
        self.view = VendasView()

    def registrar_venda(self, item_id, quantidade, preco_unitario):
        self.model.registrar_venda(item_id, quantidade, preco_unitario)

    def listar_vendas(self):
        vendas = self.model.listar_vendas()
        self.view.exibir_lista(vendas)

    def get_venda(self, id):
        venda = self.model.get_venda(id)
        if venda:
            self.view.exibir_venda(venda)
        else:
            print("Venda não encontrada.")
            import sqlite3
from core.database import Database
from datetime import datetime

class CompraItem:
    def __init__(self, id, data, item_id, quantidade, preco_unitario):
        self.
